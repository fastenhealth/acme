<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Fasten Connect Pentest · Production</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pentest harness for the Fasten Connect production widget.">
    <link rel="stylesheet" href="https://cdn.fastenhealth.com/connect/v3/fasten-stitch-element.css">
    <style>
        :root {
            color-scheme: light;
            --bg: #f5f7fb;
            --panel: rgba(255, 255, 255, 0.92);
            --panel-border: rgba(15, 23, 42, 0.08);
            --text-primary: #0f172a;
            --text-muted: #475569;
            --accent: #38bdf8;
            --terminal-bg: #02060f;
            --terminal-border: #0f172a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Inter", "SF Pro Display", "Segoe UI", system-ui, -apple-system, sans-serif;
            background: radial-gradient(circle at top, #ffffff, var(--bg) 75%);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: stretch;
            padding: 2.5rem 1.5rem;
        }

        main {
            width: min(1100px, 100%);
            display: grid;
            gap: 1.5rem;
        }

        .panel {
            background: var(--panel);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 1.75rem;
            box-shadow: 0 15px 40px rgba(15, 23, 42, 0.08);
        }

        .intro h1 {
            margin: 0 0 0.5rem;
            font-size: clamp(1.5rem, 1.1rem + 1.5vw, 2.4rem);
        }

        .intro p {
            margin: 0;
            color: var(--text-muted);
            max-width: 60ch;
            line-height: 1.5;
        }

        .widget-shell {
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.85);
            padding: 1.25rem;
        }

        fasten-stitch-element {
            display: block;
        }

        .terminal {
            padding: 1.25rem 1.5rem 1.5rem;
        }

        .terminal-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .terminal-dots {
            display: flex;
            gap: 0.35rem;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-dot.red { background: #f87171; }
        .terminal-dot.yellow { background: #facc15; }
        .terminal-dot.green { background: #34d399; }

        .terminal-body {
            background: var(--terminal-bg);
            border-radius: 10px;
            border: 1px solid var(--terminal-border);
            padding: 1.25rem;
            min-height: 260px;
            max-height: 380px;
            overflow-y: auto;
            font-family: "JetBrains Mono", "SFMono-Regular", ui-monospace, Menlo, Consolas, monospace;
            font-size: 0.9rem;
        }

        .terminal-line {
            margin: 0 0 1rem;
            color: #f8fafc;
        }

        .terminal-line:last-child {
            margin-bottom: 0;
        }

        .terminal-line__summary {
            color: var(--accent);
            font-weight: 600;
            margin: 0 0 0.25rem;
        }

        .terminal-line__data {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
            color: #e2e8f0;
        }

        .terminal-line--muted {
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 768px) {
            body {
                padding: 1.25rem;
            }

            .panel {
                padding: 1.25rem;
            }
        }
    </style>
</head>
<body>
<main>
    <section class="panel intro">
        <h1>Fasten Connect · Live Mode</h1>
        <p>
            Minimal harness for Penetration testers. The Fasten Connect Stitch widget below is configured for "live" mode, and every emitted event is mirrored into the "terminal" viewer for inspection.
        </p>
    </section>

    <section class="panel widget-panel">
        <div class="widget-shell">
            <fasten-stitch-element
                    external-id="1235-123412-123123$^#*@(!"
                    public-id="public_live_luezin9lp65gprse02h0jox7dmkhi5406kujj4fjsar1b"
            ></fasten-stitch-element>
        </div>
    </section>

    <section class="panel terminal" aria-live="polite">
        <div class="terminal-header">
            <div class="terminal-dots">
                <span class="terminal-dot red"></span>
                <span class="terminal-dot yellow"></span>
                <span class="terminal-dot green"></span>
            </div>
            Fasten Connect event stream
        </div>
        <div class="terminal-body" data-event-log>
            <p class="terminal-line terminal-line--muted" data-placeholder>Waiting for Fasten Connect events…</p>
        </div>
    </section>
</main>

<script src="https://cdn.fastenhealth.com/connect/v3/fasten-stitch-element.js" type="module"></script>
<script>
    const widget = document.querySelector('fasten-stitch-element');
    const logContainer = document.querySelector('[data-event-log]');
    const maxEntries = 200;

    const addLog = (label, payload) => {
        if (!logContainer) return;
        const placeholder = logContainer.querySelector('[data-placeholder]');
        if (placeholder) {
            placeholder.remove();
        }

        const wrapper = document.createElement('div');
        wrapper.className = 'terminal-line';

        const summary = document.createElement('div');
        summary.className = 'terminal-line__summary';
        const timestamp = new Date().toLocaleTimeString([], { hour12: false });
        summary.textContent = `[${timestamp}] ${label}`;

        const dataBlock = document.createElement('pre');
        dataBlock.className = 'terminal-line__data';
        const formatted = typeof payload === 'string' ? payload : JSON.stringify(payload, null, 2);
        dataBlock.textContent = formatted;

        wrapper.append(summary, dataBlock);
        logContainer.appendChild(wrapper);

        while (logContainer.children.length > maxEntries) {
            logContainer.removeChild(logContainer.firstChild);
        }

        logContainer.scrollTop = logContainer.scrollHeight;
    };

    const handleEvent = (event) => {
        let parsed;
        try {
            parsed = event.detail?.data ? JSON.parse(event.detail.data) : event.detail;
        } catch (error) {
            parsed = { parse_error: error.message, raw: event.detail?.data };
        }
        const eventType = parsed?.event_type || 'widget.event';
        addLog(eventType, parsed);
        console.log('[Fasten Connect event]', parsed);
    };

    if (widget) {
        widget.addEventListener('eventBus', handleEvent);
        addLog('system.init', { message: 'Listening for Fasten Connect widget events' });
    } else {
        addLog('system.error', { message: 'fasten-stitch-element not found on page' });
    }
</script>
</body>
</html>
