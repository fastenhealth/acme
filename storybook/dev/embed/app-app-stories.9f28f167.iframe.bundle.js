(self.webpackChunkfasten_connect_frontend_ngx=self.webpackChunkfasten_connect_frontend_ngx||[]).push([[866],{"./projects/fasten-connect-stitch-embed/src/app/app.component.css?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,"\n",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./projects/fasten-connect-stitch-embed/src/app/app.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,default:()=>app_stories});var dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var app_componentngResource=__webpack_require__("./projects/fasten-connect-stitch-embed/src/app/app.component.css?ngResource"),app_componentngResource_default=__webpack_require__.n(app_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),public_api=__webpack_require__("./projects/shared-library/src/public-api.ts"),fasten_service=__webpack_require__("./projects/fasten-connect-stitch-embed/src/app/services/fasten.service.ts"),router=__webpack_require__("./node_modules/@angular/router/fesm2022/router.mjs"),ngx_logger=__webpack_require__("./node_modules/ngx-logger/fesm2020/ngx-logger.mjs"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs");let AppComponent=class AppComponent{populateInputsFromWindowLocation(){let urlParams=new URLSearchParams(window.location.search);this.publicId=urlParams.get("public-id")||"",this.externalId=urlParams.get("external-id")||"",this.externalState=urlParams.get("external-state")||"",this.reconnectOrgConnectionId=urlParams.get("reconnect-org-connection-id")||"",this.searchOnly="true"==urlParams.get("search-only"),this.tefcaMode="true"==urlParams.get("tefca-mode"),this.eventTypes=urlParams.get("event-types")||"",this.staticBackdrop="true"==urlParams.get("static-backdrop"),this.searchQuery=urlParams.get("search-query")||"",this.showSplash="true"==urlParams.get("show-splash"),this.brandId=urlParams.get("brand-id")||"",this.portalId=urlParams.get("portal-id")||"",this.endpointId=urlParams.get("endpoint-id")||"",this.sdkMode=urlParams.get("sdk-mode")||public_api.eu.None}constructor(activatedRoute,configService,messageBus,fastenService,router,logger){this.activatedRoute=activatedRoute,this.configService=configService,this.messageBus=messageBus,this.fastenService=fastenService,this.router=router,this.logger=logger,this.publicId="",this.externalId="",this.externalState="",this.tefcaMode=!1,this.staticBackdrop=!1,this.eventTypes="",this.showSplash=!1,this.searchOnly=!1,this.searchQuery="",this.brandId="",this.portalId="",this.endpointId="",this.sdkMode="",this.loading=!0}ngOnInit(){this.logger.info("QUERY STRING MAP",new URLSearchParams(window.location.search)),this.populateInputsFromWindowLocation();let apiMode=this.getApiModeFromPublicId(this.publicId),eventTypes=[];if(this.eventTypes&&(eventTypes=this.eventTypes.split(",").map((eventType=>eventType)).filter((eventType=>Object.values(public_api.wf).indexOf(eventType)>=0))),this.sdkMode||(this.sdkMode=public_api.eu.None),this.configService.systemConfig={apiMode,publicId:this.publicId,externalId:this.externalId,reconnectOrgConnectionId:this.reconnectOrgConnectionId,staticBackdrop:this.staticBackdrop,searchOnly:this.searchOnly,tefcaMode:this.tefcaMode,eventTypes,sdkMode:this.sdkMode},this.messageBus.messageBusSubject.subscribe((eventPayload=>{this.logger.debug("bubbling up event",eventPayload),this.sendPostMessage(eventPayload)})),this.reconnectOrgConnectionId)this.fastenService.getOrgConnectionById(this.publicId,this.reconnectOrgConnectionId).subscribe((orgConnection=>{this.logger.info("state: dashboard/connecting#reconnectOrgConnectionId",orgConnection),this.router.navigate(["dashboard/connecting"],{queryParams:{brandId:orgConnection.catalog_brand_id,portalId:orgConnection.catalog_portal_id,endpointId:orgConnection.catalog_endpoint_id,orgConnectionId:orgConnection.org_connection_id,externalId:this.externalId,externalState:this.externalState,sdkMode:this.sdkMode}})}),(err=>{this.errorMessage="Could not find the patient connection using id. Please contact the developer of this app.",this.logger.error("Invalid Fasten Connect Connection ID",err)}));else if(this.brandId&&this.portalId&&this.endpointId)this.logger.info("state: dashboard/connecting"),this.router.navigate(["dashboard/connecting"],{queryParams:{brandId:this.brandId,portalId:this.portalId,endpointId:this.endpointId,externalId:this.externalId,externalState:this.externalState,sdkMode:this.sdkMode}});else if(this.brandId)this.fastenService.searchCatalogBrand(apiMode,this.brandId).subscribe((brandItem=>{this.logger.info("state: brand/details"),this.configService.searchConfig$.selectedBrand=brandItem._source,this.router.navigateByUrl("brand/details")}));else if(this.searchOnly)if(this.showSplash)this.logger.info("state: splash"),this.router.navigateByUrl("splash");else{this.logger.info("state: search");let queryParams={};this.searchQuery&&(queryParams.searchQuery=this.searchQuery),this.router.navigate(["search"],{queryParams})}}ngOnChanges(changes){this.logger.debug("embed ngOnChanges",changes)}getApiModeFromPublicId(publicId){let publicIdParts=publicId.split("_"),apiMode=public_api.wx.Test;return 3==publicIdParts.length&&publicIdParts[1]==public_api.wx.Live&&(apiMode=public_api.wx.Live),3!=publicIdParts.length?(console.error("Could not register Fasten Connect installation: missing or invalid id",this.publicId),this.errorMessage="Could not register Fasten Connect installation: missing or invalid id. Please contact the developer of this app.",this.messageBus.publishWidgetConfigError(),this.configService.systemConfig={org:void 0},this.loading=!1,apiMode):(this.errorMessage="",this.fastenService.getOrgByPublicId(this.publicId).subscribe((org=>{this.logger.info("Fasten Connect registration",org),this.loading=!1,this.configService.systemConfig={org}}),(err=>{this.loading=!1,this.errorMessage="Could not register Fasten Connect installation using id. Please contact the developer of this app.",this.messageBus.publishWidgetConfigError(),this.logger.error("Invalid Fasten Connect registration",err)})),apiMode)}modalClose(){this.logger.info("modalClose pressed"),this.messageBus.publishRequestClose()}receivePostMessage(event){this.logger.debug("received postMessage",event)}sendPostMessage(eventPayload){if(null!=eventPayload)if(this.sdkMode==public_api.eu.ReactNative&&window.ReactNativeWebView)this.logger.info("sending postMessage to React Native WebView",eventPayload),window.ReactNativeWebView.postMessage(JSON.stringify({from:public_api.qo.PrimaryWebView,to:public_api.qo.External,payload:JSON.stringify(eventPayload)}));else{if(!window.opener&&!window.parent)return void this.logger.debug("No parent window to send message to",this.sdkMode);this.logger.info("sending postMessage",eventPayload),(window.parent||window.opener).postMessage(JSON.stringify(eventPayload),"*")}else this.logger.warn("No eventPayload to send")}static{this.ctorParameters=()=>[{type:router.nX},{type:public_api.we},{type:public_api.BG},{type:fasten_service.B},{type:router.Ix},{type:ngx_logger.so}]}static{this.propDecorators={publicId:[{type:core.Input,args:["public-id"]}],externalId:[{type:core.Input,args:["external-id"]}],externalState:[{type:core.Input,args:["external-state"]}],reconnectOrgConnectionId:[{type:core.Input,args:["reconnect-org-connection-id"]}],tefcaMode:[{type:core.Input,args:["tefca-mode"]}],staticBackdrop:[{type:core.Input,args:["static-backdrop"]}],eventTypes:[{type:core.Input,args:["event-types"]}],showSplash:[{type:core.Input,args:["show-splash"]}],searchOnly:[{type:core.Input,args:["search-only"]}],searchQuery:[{type:core.Input,args:["search-query"]}],brandId:[{type:core.Input,args:["brand-id"]}],portalId:[{type:core.Input,args:["portal-id"]}],endpointId:[{type:core.Input,args:["endpoint-id"]}],sdkMode:[{type:core.Input,args:["sdk-mode"]}],receivePostMessage:[{type:core.HostListener,args:["window:message",["$event"]]}]}}};AppComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"app-root",template:'<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter">\n\n<div *ngIf="(configService.systemConfigSubject | async)?.apiMode == \'test\'" id="test-mode-banner"\n     class="top-0 sticky z-50 w-full mb-2 bg-[#DC3545] text-white text-center py-2 px-4 rounded-t-lg font-medium text-sm flex items-center justify-center gap-2">\n  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-construction"><rect x="2" y="6" width="20" height="8" rx="1"/><path d="M17 14v7"/><path d="M7 14v7"/><path d="M17 3v3"/><path d="M7 3v3"/><path d="M10 14 2.3 6.3"/><path d="m14 6 7.7 7.7"/><path d="m8 6 8 8"/></svg>\n  You are using Fasten in test mode\n</div>\n\n<ng-container *ngIf="loading && searchOnly">\n  \x3c!-- Skeleton Loader for Search Box --\x3e\n  <div class="p-6 space-y-6 fade-in">\n    \x3c!-- Logo --\x3e\n    <div class="relative flex justify-center items-center">\n      <h1 class="az-logo">fasten</h1>\n    </div>\n\n    \x3c!-- Search input and filter button --\x3e\n    <div class="animate-pulse flex gap-2">\n      <div class="flex-1">\n        <div class="skeleton h-10 w-full rounded-md"></div>\n      </div>\n      <div class="skeleton skeleton-button"></div>\n    </div>\n\n    \x3c!-- Results section --\x3e\n    <div class="animate-pulse space-y-2 overflow-scroll" style="max-height: 600px;">\n      \x3c!-- Repeating skeleton card items --\x3e\n      <div class="skeleton-card">\n        <div class="skeleton skeleton-circle"></div>\n        <div class="flex-1 space-y-1">\n          <div class="skeleton skeleton-text w-32"></div>\n          <div class="skeleton skeleton-text w-20"></div>\n        </div>\n        <div class="skeleton w-5 h-5 rounded"></div>\n      </div>\n      <div class="skeleton-card">\n        <div class="skeleton skeleton-circle"></div>\n        <div class="flex-1 space-y-1">\n          <div class="skeleton skeleton-text w-32"></div>\n          <div class="skeleton skeleton-text w-20"></div>\n        </div>\n        <div class="skeleton w-5 h-5 rounded"></div>\n      </div>\n    </div>\n  </div>\n\n</ng-container>\n\n<ng-container *ngIf="loading && !searchOnly">\n  \x3c!-- Skeleton Loader for Vault Profile Login --\x3e\n\n  <div id="vault-profile-skeleton-loader" class="p-6 space-y-6 animate-pulse">\n    \x3c!-- Logo --\x3e\n    <div class="flex justify-center items-center">\n      <div class="skeleton skeleton-text w-24 h-8 rounded-md"></div>\n    </div>\n\n    \x3c!-- Organization Logo and Animation --\x3e\n    <div class="flex items-center justify-center space-x-4">\n      <div class="skeleton skeleton-circle"></div>\n      <div class="flex space-x-1">\n        <div class="skeleton w-2 h-2 rounded-full"></div>\n        <div class="skeleton w-2 h-2 rounded-full"></div>\n        <div class="skeleton w-2 h-2 rounded-full"></div>\n      </div>\n      <div class="skeleton skeleton-circle"></div>\n    </div>\n\n    \x3c!-- Title and Description --\x3e\n    <div class="text-center space-y-2">\n      <div class="skeleton skeleton-text w-48 h-6 rounded-md"></div>\n      <div class="skeleton skeleton-text w-64 h-4 rounded-md"></div>\n    </div>\n\n    \x3c!-- Info Cards --\x3e\n    <div class="space-y-4">\n      <div class="skeleton-info-card">\n        <div class="skeleton skeleton-circle"></div>\n        <div class="flex-1 space-y-1">\n          <div class="skeleton skeleton-text w-24"></div>\n          <div class="skeleton skeleton-text w-40"></div>\n        </div>\n      </div>\n      <div class="skeleton-info-card">\n        <div class="skeleton skeleton-circle"></div>\n        <div class="flex-1 space-y-1">\n          <div class="skeleton skeleton-text w-24"></div>\n          <div class="skeleton skeleton-text w-40"></div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Form --\x3e\n    <div class="space-y-4">\n      <div class="skeleton skeleton-text w-32"></div>\n      <div class="skeleton h-10 w-full rounded-md"></div>\n      <div class="mt-50 skeleton h-10 w-full rounded-md"></div>\n    </div>\n  </div>\n\n</ng-container>\n\n<ng-container *ngIf="!loading && !!!errorMessage">\n  <div id="widget-container" class="w-full p-6 min-h-96 fade-in flex h-screen flex-col overflow-hidden">\n    <div class="flex-1 min-h-0 flex flex-col">\n      <router-outlet></router-outlet>\n    </div>\n  </div>\n</ng-container>\n\n<ng-container *ngIf="!loading && errorMessage">\n<div id="error-container" class="w-full p-6 min-h-96">\n  <div class="relative p-4 w-full max-w-2xl h-full md:h-auto">\n    <div id="alert-additional-content-2" class="p-4 border border-red-300 rounded-lg bg-[#DC3545] text-white" role="alert">\n      <div class="flex items-center">\n        <svg class="flex-shrink-0 w-4 h-4 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24">\n          <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm7.707-3.707a1 1 0 0 0-1.414 1.414L10.586 12l-2.293 2.293a1 1 0 1 0 1.414 1.414L12 13.414l2.293 2.293a1 1 0 0 0 1.414-1.414L13.414 12l2.293-2.293a1 1 0 0 0-1.414-1.414L12 10.586 9.707 8.293Z" clip-rule="evenodd"/>\n        </svg>\n\n        <span class="sr-only">Error</span>\n        <h3 class="text-lg font-medium">Configuration Error</h3>\n      </div>\n      <div class="mt-2 mb-4 text-sm">\n        {{errorMessage}}\n      </div>\n      <div class="flex">\n\n        <button (click)="modalClose()" type="button"\n                class="text-white bg-transparent border border-white hover:bg-red-900 hover:text-white focus:ring-4 focus:outline-none focus:ring-grey-300 font-medium rounded-lg text-xs px-3 py-1.5 text-center">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n</ng-container>\n',standalone:!0,imports:[common.MD,router.n3,router.iI],styles:[app_componentngResource_default()]})],AppComponent);var app_routes=__webpack_require__("./projects/fasten-connect-stitch-embed/src/app/app.routes.ts"),http=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs"),ngx_logger_testing=__webpack_require__("./node_modules/ngx-logger/fesm2020/ngx-logger-testing.mjs");let mockConfigService={systemConfigSubject:new(__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js").t)({key:"value"}),systemConfig$:{publicId:"public_live_2rzrytsspr29g36o7fgbyo7k28ds4uyqbot3h0k80p0bm",apiMode:public_api.wx.Test}};const app_stories={title:"Widget App Component",component:AppComponent,decorators:[(0,dist.L4)({providers:[(0,core.importProvidersFrom)(http.q1,ngx_logger_testing.D0),(0,router.lh)(app_routes.J),{provide:public_api.we,useValue:mockConfigService}]})],tags:["autodocs"]},Primary={};Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  // args: {\n  //   primary: true,\n  //   label: 'Button',\n  // },\n}",...Primary.parameters?.docs?.source}}}}}]);