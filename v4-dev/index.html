<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Share Your Medical Record</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <style>
        fasten-stitch > button {
            background-color: green !important;
            margin-left: 180px !important;
        }
    </style>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f3f4f7, #e2e6ea);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: url("https://plus.unsplash.com/premium_photo-1673953510197-0950d951c6d9?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjF8fG1lZGljYWx8ZW58MHx8MHx8fDA%3D");
            background-size: auto 120%;
        }

        .share-wrapper {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
        }
        .share-container {
            font-family: Arial, sans-serif;
            background: #fff;
            padding: 40px 30px;
            text-align: center;
        }

        .share-container > h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .share-container > p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #555;
        }

        .share-container > form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .share-container > form > input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        /*.button {*/
        /*  display: inline-block;*/
        /*  background-color: #007bff;*/
        /*  color: white;*/
        /*  text-decoration: none;*/
        /*  font-size: 16px;*/
        /*  font-weight: bold;*/
        /*  padding: 12px 20px;*/
        /*  border-radius: 8px;*/
        /*  transition: background-color 0.3s, transform 0.2s;*/
        /*  cursor: pointer;*/
        /*  border: none;*/
        /*}*/

        /*.button:hover {*/
        /*  background-color: #0056b3;*/
        /*  transform: scale(1.05);*/
        /*}*/

        .share-container > .footer {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }

        @media (max-width: 480px) {
            .share-container > h1 {
                font-size: 24px;
            }

            .share-container > p {
                font-size: 14px;
            }

            .share-container > input {
                font-size: 14px;
                padding: 8px;
            }

        }

        .control-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            z-index: 150;
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 16px 0 16px 16px;
            gap: 0;
        }

        .control-sidebar__toggle {
            border: 1px solid rgba(148, 163, 184, 0.4);
            border-right: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 9999px;
            padding: 16px 8px;
            margin-top: 16px;
            margin-right: -1px;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.35);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: background 0.2s ease, box-shadow 0.2s ease;
        }

        .control-sidebar__toggle span {
            display: block;
            width: 3px;
            height: 18px;
            background: #6366f1;
            border-radius: 9999px;
        }

        .control-sidebar--open .control-sidebar__toggle {
            background: rgba(99, 102, 241, 0.15);
            box-shadow: 0 12px 22px rgba(79, 70, 229, 0.35);
        }

        .control-sidebar__panel {
            width: min(340px, calc(100vw - 80px));
            height: calc(100vh - 32px);
            margin-right: 0;
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(12px);
            border-radius: 18px 0 0 18px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            border-right: none;
            box-shadow: -10px 12px 35px rgba(15, 23, 42, 0.35);
            padding: 20px 18px 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.35s ease;
        }

        .control-sidebar--open .control-sidebar__panel {
            transform: translateX(0);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-nav hr {
            border-color: rgba(15, 23, 42, 0.08);
        }

        .event-terminal {
            width: 100%;
            border-radius: 12px;
            background: rgba(2, 6, 23, 0.92);
            border: 1px solid rgba(56, 189, 248, 0.5);
            box-shadow: 0 20px 35px rgba(15, 23, 42, 0.45);
            color: #d1d5db;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            overflow: hidden;
        }

        .event-terminal summary {
            list-style: none;
            cursor: pointer;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-weight: 600;
            color: #f8fafc;
            background: rgba(15, 23, 42, 0.9);
        }

        .event-terminal summary::-webkit-details-marker {
            display: none;
        }

        .event-terminal[open] summary {
            border-bottom: 1px solid rgba(56, 189, 248, 0.35);
        }

        .event-terminal__count {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
        }

        .event-terminal__body {
            padding: 12px 16px 16px;
        }

        .event-terminal__lights {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .event-terminal__lights span {
            width: 10px;
            height: 10px;
            border-radius: 9999px;
            display: inline-block;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
        }

        .event-terminal__light--red {
            background: #f87171;
        }

        .event-terminal__light--yellow {
            background: #facc15;
        }

        .event-terminal__light--green {
            background: #34d399;
        }

        .event-terminal pre {
            margin: 0;
            max-height: 260px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 12px;
            line-height: 1.4;
            color: #cbd5f5;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.fastenhealth.com/connect/dev-element-feat/websockets/fasten-stitch-element.css">

    <!-- Tailwind CSS, only required to style this page, not the fasten element -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body x-data="pageData()">
<script src="https://cdn.fastenhealth.com/connect/dev-element-feat/websockets/fasten-stitch-element.js" type="module"></script>

<div class="control-sidebar" :class="{ 'control-sidebar--open': controlSidebarOpen }">
    <button
            type="button"
            aria-label="Toggle controls"
            class="control-sidebar__toggle"
            @click="toggleControlSidebar"
            :aria-pressed="controlSidebarOpen.toString()"
    >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" />
        </svg>

    </button>

    <div class="control-sidebar__panel">
        <nav class="sidebar-nav">
            <button
                    @click="toggleSearchOnly"
                    :class="{ 'bg-indigo-50 text-indigo-600': searchOnly, 'text-gray-700 hover:bg-gray-100': !searchOnly }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - Search -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                    Search
                </span>
            </button>

            <button
                    @click="toggleReconnectOrgConnectionId"
                    :class="{ 'bg-indigo-50 text-indigo-600': !!reconnectOrgConnectionId, 'text-gray-700 hover:bg-gray-100': !!!reconnectOrgConnectionId }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - arrow-path-rounded-square -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
                    </svg>
                    Reconnect
                </span>
            </button>

            <button
                    @click="toggleStaticBackdrop"
                    :class="{ 'bg-indigo-50 text-indigo-600': staticBackdrop, 'text-gray-700 hover:bg-gray-100': !staticBackdrop }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - x-circle -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    Backdrop
                </span>
            </button>

            <button
                    @click="toggleSplash"
                    :class="{ 'bg-indigo-50 text-indigo-600': showSplash, 'text-gray-700 hover:bg-gray-100': !showSplash }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - shield-exclaimation -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.25-8.25-3.286Zm0 13.036h.008v.008H12v-.008Z" />
                    </svg>
                    Splash
                </span>
            </button>

            <button
                    @click="toggleShow"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - power-->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9" />
                    </svg>
                    Show via JS
                </span>
            </button>

            <button
                    @click="toggleEventTypes"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - cube-->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                    </svg>
                    Event Types
                </span>
            </button>

            <button
                    @click="toggleSortByLocation"
                    :class="{ 'bg-indigo-50 text-indigo-600': sortByLocation, 'text-gray-700 hover:bg-gray-100': !sortByLocation }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - map-->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                    </svg>
                    Location
                </span>
            </button>

            <button
                    @click="toggleTefcaMode"
                    :class="{ 'bg-indigo-50 text-indigo-600': tefcaMode, 'text-gray-700 hover:bg-gray-100': !tefcaMode }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - beaker-->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                    </svg>
                    TEFCA
                </span>
            </button>

            <button
                    @click="toggleCspPromptForce"
                    :class="{ 'bg-indigo-50 text-indigo-600': cspPromptForce, 'text-gray-700 hover:bg-gray-100': !cspPromptForce }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - identification-->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z" />
                    </svg>
                    CSP Prompt
                </span>
            </button>

            <hr />

            <button
                    @click="toggleError"
                    :class="{ 'bg-fuchsia-50 text-fuchsia-900': publicId == 'invalid_config_public_id', 'text-gray-700 hover:bg-gray-100': publicId != 'invalid_config_public_id' }"
                    class="flex min-h-[40px] w-full flex-row items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition"
            >
                <span class="flex items-center gap-2">
                    <!-- HeroIcon - exclamation-circle -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                    Error Config
                </span>
            </button>
        </nav>

        <details id="event-terminal" class="event-terminal">
            <summary>
                <span>Event Bus Terminal</span>
                <span id="event-terminal-count" class="event-terminal__count">0 events</span>
            </summary>
            <div class="event-terminal__body">
                <div class="event-terminal__lights">
                    <span class="event-terminal__light--red"></span>
                    <span class="event-terminal__light--yellow"></span>
                    <span class="event-terminal__light--green"></span>
                </div>
                <pre id="event-terminal-log">$ Waiting for events...</pre>
            </div>
        </details>
    </div>
</div>

<div class="share-wrapper" >
    <div class="share-container">
        <h1>Acme Labs - Study Enrollment</h1>
        <p>Acme Labs empowers patients like you to securely share your medical records. By contributing, you play a vital role in advancing healthcare and innovation.</p>
        <form action="#" method="POST">
            <input type="text" name="name" placeholder="Full Name" required>
            <input type="date" name="birthdate" placeholder="Date of Birth" required>
            <input type="text" name="zipcode" placeholder="Zip Code" required>
            <input type="email" name="email" placeholder="Email Address" required>
            <input type="tel" name="phone" placeholder="Phone Number">

        </form>
        <p class="footer">Your information is handled with the utmost security and in full compliance with HIPAA regulations.</p>
    </div>
    <fasten-stitch-element
            external-id="1235-123412-123123$^#*@(!"
            :public-id="publicId"
            :search-only="searchOnly"
            :show-splash="showSplash"
            :tefca-mode="tefcaMode"
            :tefca-csp-prompt-force="cspPromptForce"
            :static-backdrop="staticBackdrop"
            :reconnect-org-connection-id="reconnectOrgConnectionId"
            :search-sort-by="sortBy"
            :search-sort-by-opts="sortByOpts"
            :event-types="eventTypes"

    ></fasten-stitch-element>

    <h1>RECONNECT ELEMENT</h1>
    <fasten-stitch-element
            external-id="1235-123412-123123$^#*@(!"
            public-id="public_test_rei2un7aagh5pquwikxh2dsyq23bsdyu4l8vm9eq29ftu"
            search-only="true"
            reconnect-org-connection-id="c2f0358c-f330-49ed-b32f-8018296873a2"
    ></fasten-stitch-element>
</div>

    <script type="application/javascript">
        let connections = [];

        const terminalLogEl = document.getElementById('event-terminal-log');
        const terminalCountEl = document.getElementById('event-terminal-count');
        const terminalEntries = [];
        const MAX_TERMINAL_ENTRIES = 60;

        const safeStringify = (value) => {
            if (value === undefined || value === null || value === '') {
                return '';
            }
            if (typeof value === 'string') {
                return value;
            }
            try {
                return JSON.stringify(value);
            } catch (error) {
                console.warn('Unable to stringify event data', error);
                return '[unserializable]';
            }
        };

        const updateTerminalCount = () => {
            if (!terminalCountEl) {
                return;
            }
            const label = terminalEntries.length === 1 ? 'event' : 'events';
            terminalCountEl.textContent = `${terminalEntries.length} ${label}`;
        };

        const appendTerminalEvent = (payload, event) => {
            if (!terminalLogEl) {
                return;
            }

            const timestamp = new Date().toLocaleTimeString();
            const eventType = (payload && payload.event_type) || event?.type || 'eventBus';
            const messageSource =
                payload && typeof payload === 'object' && Object.prototype.hasOwnProperty.call(payload, 'data')
                    ? payload.data
                    : payload;
            const serializedData = safeStringify(messageSource);
            const line = `[${timestamp}] ${eventType}${serializedData ? ` â€” ${serializedData}` : ''}`;

            terminalEntries.push(line);
            if (terminalEntries.length > MAX_TERMINAL_ENTRIES) {
                terminalEntries.shift();
            }
            terminalLogEl.textContent = terminalEntries.join('\n');
            updateTerminalCount();
        };

        const widgets = document.querySelectorAll('fasten-stitch-element');
        const primaryWidget = widgets[0];

        const handleEventBus = (event) => {
            console.log("EVENT BUS:", event.detail)
            let eventPayload;

            try {
                eventPayload = event?.detail?.data ? JSON.parse(event.detail.data) : event.detail;
            } catch (error) {
                console.warn('Unable to parse eventBus payload', error);
                eventPayload = { event_type: event.detail?.type || 'unknown', data: event.detail?.data || null };
            }

            appendTerminalEvent(eventPayload, event);

            if(!primaryWidget || event.currentTarget !== primaryWidget) {
                return;
            }

            if(eventPayload && eventPayload.event_type == 'widget.complete') {
                console.log(eventPayload.event_type, connections);

                connections = eventPayload.data;
                if(connections && connections.length > 0){
                    var firstConnection = connections[0];
                    //redirect to the redirect.html file with these querystring parameters.
                    const currentURL = window.location.href;
                    var parsedURL = new URL(currentURL);
                    var pathParts = parsedURL.pathname.split("/")
                    pathParts.pop()
                    pathParts.push("redirect.html")
                    parsedURL.pathname = pathParts.join("/")

                    var params = new URLSearchParams(parsedURL.search);
                    for(let key of Object.getOwnPropertyNames(firstConnection)){
                        params.set(key, firstConnection[key]);
                    }
                    parsedURL.search = params.toString();

                    //change the current window location to the new URL
                    window.location.href = parsedURL.toString();
                }
            }

        };

        widgets.forEach((widget) => widget.addEventListener('eventBus', handleEventBus));


        window.addEventListener('DOMContentLoaded',function () {
            //your code here
            // document.querySelector('fasten-stitch').show();
        });
    </script>


    <script type="module">
        import alpinejs from 'https://cdn.skypack.dev/alpinejs@v3.13.4';

        alpinejs.data('pageData', pageData);
        alpinejs.start();

        export function pageData() {
            return {
                searchOnly: false,
                showSplash: false,
                publicId: 'public_test_rei2un7aagh5pquwikxh2dsyq23bsdyu4l8vm9eq29ftu',
                staticBackdrop: false,
                tefcaMode: false,
                cspPromptForce: false,
                reconnectOrgConnectionId: "",
                sortByLocation: false,
                sortBy: '',
                sortByOpts: '',
                eventTypes: "",
                controlSidebarOpen: false,

                toggleStaticBackdrop() {
                    this.staticBackdrop = !this.staticBackdrop;
                },
                toggleSplash() {
                    this.showSplash = !this.showSplash;
                },
                toggleSearchOnly() {
                    this.searchOnly = !this.searchOnly;
                },
                toggleSortByLocation() {
                    this.sortByLocation = !this.sortByLocation;
                    if (this.sortByLocation) {
                        this.sortBy = 'location';
                        this.sortByOpts = '{"location":{"zipcodes":["11201"]}}';
                    } else {
                        this.sortBy = '';
                        this.sortByOpts = '';
                    }
                },
                toggleTefcaMode() {
                    this.tefcaMode = !this.tefcaMode;
                },
                toggleCspPromptForce() {
                    this.cspPromptForce = !this.cspPromptForce;
                },
                toggleReconnectOrgConnectionId() {
                    this.reconnectOrgConnectionId = this.reconnectOrgConnectionId ? "" : "9254f721-e3cb-46f4-9bcf-7ef9910657b9";
                },
                toggleEventTypes() {
                    this.eventTypes = this.eventTypes ? "" : "search.query";
                },
                toggleShow() {
                    document.querySelector('fasten-stitch-element').show();
                },
                toggleError() {
                    if(this.publicId === 'invalid_config_public_id') {
                        this.publicId = 'public_test_rei2un7aagh5pquwikxh2dsyq23bsdyu4l8vm9eq29ftu';
                    } else {
                        this.publicId = 'invalid_config_public_id';
                    }
                },
                toggleControlSidebar() {
                    this.controlSidebarOpen = !this.controlSidebarOpen;
                }
            }
        }

    </script>
</body>
</html>
